(function(f){function n(a){return"function"===typeof String.prototype.trim?a.trim():a.replace(/^\s+/,"").replace(/\s+$/,"")}function l(a,b){a.className=n(a.className+" "+b)}function r(){if(f.getSelection)return f.getSelection().toString();if(document.getSelection)return document.getSelection();if(document.selection)return document.selection.createRange().text}function i(a){e=a||f.event;doc=document.body||document.documentElement;return{x:e.pageX||e.clientX+doc.scrollLeft,y:e.pageY||e.clientY+doc.scrollTop}}
function p(a,b){var c=i(b),d=document.body||document.documentElement,g=a.getBoundingClientRect();return{x:c.x-(g.left+d.scrollLeft),y:c.y-(g.top+d.scrollTop)}}function j(a,b){var c=document.createElement(a);for(k in b)c[k]=b[k];return c}if("undefined"===typeof f.console){var m=Object.prototype.toString,h={on:function(a,b,c){var d=function(b){b=b||f.event;c.call(a,b)};a.addEventListener?a.addEventListener(b,d,!1):a.attachEvent&&a.attachEvent("on"+b,d)},stopBubble:function(a){a&&a.stopPropagation?a.stopPropagation():
f.event.cancelBubble=!0},preventDefault:function(a){a&&a.preventDefault?a.preventDefault():f.event.returnValue=!1}},q=function(){this.debug=!0;this.hInnerPadding=10;this.argSeperator="    ";this.UI={};this._init()};q.prototype={_init:function(){this._userDefined=!0;this._initUI();this._bind()},_initUI:function(){var a=j("div",{className:"console-panel"}),b=j("div",{className:"console-panel-inner"}),c=j("div",{className:"console-log"}),d=j("div",{className:"console-input",contentEditable:!0}),g=j("div",
{className:"move topMove"}),f=j("div",{className:"move rightMove"}),h=j("div",{className:"move bottomMove"}),i=j("div",{className:"move leftMove"});b.appendChild(c);b.appendChild(d);a.appendChild(b);a.appendChild(g);a.appendChild(f);a.appendChild(h);a.appendChild(i);document.getElementsByTagName("body")[0].appendChild(a);this.UI={panel:a,panelInner:b,panelLog:c,panelInput:d,topMove:g,rightMove:f,bottomMove:h,leftMove:i}},_bind:function(){var a=this,b=a.UI;a.mousePos={};a.mouseOffset={};a.mover=null;
h.on(b.panel,"click",function(){r()||b.panelInput.focus()});h.on(b.panelInput,"keypress",function(c){var d=c.keyCode;if(10==d||13==d)a._exec(b.panelInput.textContent||b.panelInput.innerText),b.panelInput.innerHTML="",h.preventDefault(c),b.panelInner.scrollTop+=999999,b.panelInput.focus()});h.on(b.topMove,"mousedown",function(c){a.mover=this;l(b.panel,"moving");a.mouseOffset=p(b.panel,c)});h.on(b.rightMove,"mousedown",function(c){a.mover=this;l(b.panel,"moving");a.mousePos=i(c)});h.on(b.bottomMove,
"mousedown",function(c){a.mover=this;l(b.panel,"moving");a.mousePos=i(c)});h.on(b.leftMove,"mousedown",function(c){a.mover=this;l(b.panel,"moving");a.mousePos=i(c);a.mouseOffset=p(b.panel,c)});h.on(document,"mouseup",function(){if(a.mover){var c=b.panel;c.className=n((" "+c.className+" ").replace(" moving ",""));a.mover=null}});h.on(document,"mousemove",function(c){switch(a.mover){case b.topMove:a._move(c);break;case b.rightMove:a._resizeH(c,"right");break;case b.leftMove:a._resizeH(c,"left");break;
case b.bottomMove:a._resizeV(c)}})},_move:function(a){var b=this.UI,a=i(a),b=b.panel.style;b.bottom="auto";b.top=a.y-this.mouseOffset.y+"px";b.left=a.x-this.mouseOffset.x+"px"},_resizeH:function(a,b){var c=this.UI,d=i(a),g=this.mousePos,g="right"==b?d.x-g.x:g.x-d.x,f=c.panel.offsetWidth;this.mousePos=d;100>=f&&0>g||(f=f+g+"px",c.panelInner.style.width=c.panelInner.offsetWidth-this.hInnerPadding+g+"px",c.panel.style.width=f,c.topMove.style.width=f,c.bottomMove.style.width=f,"left"==b&&(c.panel.style.left=
d.x-this.mouseOffset.x+"px"))},_resizeV:function(a){var b=i(a),a=b.y-this.mousePos.y,c=this.UI,d=c.panel.offsetHeight;this.mousePos=b;50>=d&&0>a||(b=d+a+"px",c.panelInner.style.height=c.panelInner.offsetHeight+a+"px",c.panel.style.height=b,c.leftMove.style.height=b,c.rightMove.style.height=b)},_exec:function(a){this._logCmd(a,"cmd");try{this.log(eval.call(f,a.replace("\n","")))}catch(b){this._logError(b.name+": "+b.message),f.err=b}},_appendLog:function(a,b){var c=j("div",{className:"console-log-line console-log-line-"+
(b||"log"),innerHTML:a.replace(/&/gm,"&amp;").replace(/</gm,"&lt")});this.UI.panelLog.appendChild(c)},_argType:function(a){return void 0===a||null===a?"special":!0===a||!1===a?"bool":"[object String]"==m.call(a)?"string":"[object Array]"==m.call(a)?"array":a.nodeType&&(1==a.nodeType||9==a.nodeType)?"node":"[object Object]"==m.call(a)?"object":"other"},_render:function(a){var b="";switch(this._argType(a)){case "special":b+=this._renderSpecial(a);break;case "bool":b+=this._renderBoolean(a);break;case "array":b+=
this._renderArray(a);break;case "string":b+=this._renderString(a);break;case "node":b+=this._renderNode(a);break;case "object":b+=this._renderObject(a);break;default:b+=this._renderDefault(a)}return b},_renderArray:function(a){for(var b="[",c=a.length,d=0,f=[];d<c;d++)f.push(this._render(a[d]));return b+=f.join(", ")+"]"},_renderNode:function(a){var b;if(!(b=a.outerHTML))b=document.createElement("div"),b.appendChild(a.cloneNode(!0)),b=b.innerHTML;return b},_renderObject:function(a){var b="{",c=[],
d;for(d in a)a.hasOwnProperty(d)&&c.push(d+": "+this._render(a[d]));return b+=c.join(", ")+"}"},_renderBoolean:function(a){return a?"true":"false"},_renderString:function(a){return'"'+a+'"'},_renderSpecial:function(a){return null===a?"null":"undefined"},_renderDefault:function(a){return a.toString()},_logError:function(a){this._appendLog(this._render(a),"error")},_logCmd:function(a){this._appendLog(this._render(a),"cmd")},log:function(){if(this.debug){try{var a=[],b=0,c="";for(il=arguments.length;b<
il;b+=1)a.push(this._render(arguments[b]));c=a.join(this.argSeperator);this._appendLog(c)}catch(d){this._appendLog(d.message,"error")}this.UI.panelInner.scrollTop+=9999}}};f.console=new q}})(this);
